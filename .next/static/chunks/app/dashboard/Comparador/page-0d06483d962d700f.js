(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{430:(e,r,a)=>{"use strict";a.d(r,{l:()=>l});var t=a(5155),o=a(4416);let l=e=>{let{open:r,onClose:a,children:l,className:n}=e;return r?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm px-4",children:(0,t.jsxs)("div",{className:"relative w-full max-w-lg rounded-xl p-6 shadow-xl bg-card text-card-foreground ".concat(n),children:[(0,t.jsxs)("button",{onClick:a,className:"absolute cursor-pointer top-4 right-4 text-muted-foreground hover:text-foreground",children:[(0,t.jsx)(o.A,{className:"w-5 h-5"}),(0,t.jsx)("span",{className:"sr-only",children:"Cerrar"})]}),l]})}):null}},1932:(e,r,a)=>{"use strict";a.d(r,{cn:()=>l});var t=a(2596),o=a(9688);function l(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return(0,o.QP)((0,t.$)(r))}},3281:(e,r,a)=>{"use strict";a.d(r,{a:()=>o});var t=a(3464);a(9509).env.NODE_TLS_REJECT_UNAUTHORIZED="0";let o=t.A.create({baseURL:"https://api.apoloenergies.es/api/apolo/v1",responseType:"json",withCredentials:!0})},5726:(e,r,a)=>{"use strict";a.d(r,{p:()=>o});var t=a(5155);a(2115);let o=e=>{let{label:r,name:a,type:o="text",placeholder:l,register:n,required:i=!1,errors:s,defaultValue:d}=e;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{htmlFor:a,className:"block text-sm font-semibold text-foreground",children:[r," ",i&&(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{id:a,type:o,placeholder:l,...n(a,{required:i}),className:"w-full placeholder:text-gray-400 bg-input text-sm rounded border px-3 py-1.5 focus:outline-none focus:ring ".concat(s&&s[a]?"border-red-500 ring-red-500":"border-border ring-blue-500"),defaultValue:d}),s&&s[a]&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Este campo es obligatorio"})]})}},6378:(e,r,a)=>{"use strict";a.d(r,{$:()=>d});var t=a(5155),o=a(2115),l=a(4624),n=a(2085),i=a(1932);let s=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground cursor-pointer rounded-xl hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground cursor-pointer rounded-xl hover:bg-destructive/90",outline:"border border-popover-foreground rounded-xl bg-background cursor-pointer hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground cursor-pointer rounded-xl hover:bg-secondary/80",ghost:"hover:bg-accent rounded-xl cursor-pointer hover:text-accent-foreground",link:"text-primary underline-offset-4 rounded-xl cursor-pointer hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=o.forwardRef((e,r)=>{let{className:a,variant:o,size:n,asChild:d=!1,...c}=e,u=d?l.DX:"button";return(0,t.jsx)(u,{className:(0,i.cn)(s({variant:o,size:n,className:a})),ref:r,...c})});d.displayName="Button"},6784:(e,r,a)=>{Promise.resolve().then(a.bind(a,6802))},6802:(e,r,a)=>{"use strict";a.d(r,{Comparador:()=>B});var t=a(5155),o=a(2115),l=a(7703),n=a(6378),i=a(4416),s=a(9946);let d=(0,s.A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var c=a(1932);let u=["image/png","image/jpeg","image/jpg","image/webp","image/bmp","image/tiff","application/pdf"],p=e=>{let{onFileSelect:r}=e,[a,l]=(0,o.useState)(null),[n,s]=(0,o.useState)(!1),p=(0,o.useRef)(null),[m,f]=(0,o.useState)(!1),x=e=>{u.includes(e.type)?(l(URL.createObjectURL(e)),s("application/pdf"===e.type),r(e)):alert("Formato no soportado.")};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-muted-foreground mb-2",children:"Sube la factura"}),(0,t.jsxs)("div",{onClick:()=>{var e;return null==(e=p.current)?void 0:e.click()},onDragOver:e=>{e.preventDefault(),f(!0)},onDragLeave:()=>f(!1),onDrop:e=>{e.preventDefault(),f(!1);let r=e.dataTransfer.files[0];r&&x(r)},className:(0,c.cn)("w-full min-h-[200px] bg-info-bg rounded-xl border border-dashed border-blue-300 px-6 py-4 flex flex-col items-center justify-center text-center transition relative cursor-pointer",m&&"ring-2 ring-blue-400"),children:[(0,t.jsx)("input",{type:"file",ref:p,accept:u.join(","),className:"hidden",onChange:e=>{var r;let a=null==(r=e.target.files)?void 0:r[0];a&&x(a)}}),a?(0,t.jsxs)("div",{className:"relative w-full flex flex-col items-center space-y-2",children:[n?(0,t.jsx)("iframe",{src:a,className:"w-full h-64 rounded-md border",title:"PDF Preview"}):(0,t.jsx)("img",{src:a,alt:"preview",className:"max-h-40 rounded-md object-contain"}),(0,t.jsx)("button",{onClick:()=>{l(null),s(!1),r("")},className:"absolute top-2 right-2 text-red-500 hover:text-red-700",children:(0,t.jsx)(i.A,{size:18})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d,{className:"w-8 h-8 text-info-subtext",strokeWidth:1.5}),(0,t.jsx)("p",{className:"text-sm font-semibold text-muted-foreground mt-2",children:"Haz clic o arrastra un archivo (PDF o imagen)"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"JPG, PNG, WEBP, BMP, TIFF, PDF"})]})]})]})},m=(0,s.A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),f=(0,s.A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var x=a(430);let v=e=>{let{value:r,onValueChange:a,min:o=0,max:l=100,step:n=1,className:i=""}=e,s=(r[0]-o)/(l-o)*100;return(0,t.jsx)("input",{type:"range",min:o,max:l,step:n,value:r[0],onChange:e=>a([Number(e.target.value)]),className:"w-full appearance-none h-2 rounded-full outline-none transition-colors bg-gray-200\n        [&::-webkit-slider-thumb]:appearance-none\n        [&::-webkit-slider-thumb]:w-4\n        [&::-webkit-slider-thumb]:h-4\n        [&::-webkit-slider-thumb]:rounded-full\n        [&::-webkit-slider-thumb]:bg-blue-600\n        [&::-webkit-slider-thumb]:cursor-pointer\n        [&::-moz-range-thumb]:appearance-none\n        [&::-moz-range-thumb]:w-4\n        [&::-moz-range-thumb]:h-4\n        [&::-moz-range-thumb]:rounded-full\n        [&::-moz-range-thumb]:bg-blue-600\n        [&::-moz-range-thumb]:cursor-pointer\n        ".concat(i),style:{background:"linear-gradient(to right, #2563eb ".concat(s,"%, #e5e7eb ").concat(s,"%)")}})};var h=a(2177);let P={"2.0TD":["Index Base","Index Coste","Index Promo","Fijo F\xe1cil","Fijo Estable","Fijo Snap","Fijo Snap Fresh","Fijo Snap Max","Fijo Snap Mini","Passpool"],"3.0TD":["Index Base","Index Coste","Index Promo","Fijo F\xe1cil","Fijo Estable","Fijo Dyn","Passpool"],"6.1TD":["Index Base","Index Coste","Index Promo","Fijo F\xe1cil","Fijo Estable","Fijo Dyn","Passpool"]},g=e=>{switch(e){case"Passpool":return 1;case"Index Promo":case"Fijo promoci\xf3n":return .8;case"Index Coste":return .5;default:return .65}};var b=a(7470),j=a(5726),N=a(5453);let y=(0,N.v)(e=>({comision:0,calcular:r=>{e({comision:(e=>{var r;let{matilData:a,feeEnergia:t,comisionEnergia:o,feePotencia:l,productoSeleccionado:n}=e;if(!(null==a?void 0:a.energia)||!(null==a?void 0:a.potencia))return 0;let i=null!=(r=a.energia.reduce((e,r)=>{var a;return e+(null!=(a=r.kwh)?a:0)},0))?r:0,s=t[0]*o*(10*i)/1e3,d=a.potencia.reduce((e,r)=>{var a;return e+(null!=(a=r.kw)?a:0)},0);return s+.5*l[0]*d})(r)})}})),w=[{modalidad:"Index Base",tarifa:"2.0TD",periodos:{P1:.1121142088,P2:.046933028,P3:.02155835}},{modalidad:"Index Base",tarifa:"3.0TD",periodos:{P1:.0809619257,P2:.0556045379,P3:.0366587427,P4:.0280635428,P5:.0231665428,P6:.02119535}},{modalidad:"Index Base",tarifa:"6.1TD",periodos:{P1:.0621439395,P2:.04206413625,P3:.0287916825,P4:.02323049865,P5:.01934449865,P6:.018276775}},{modalidad:"Fijo F\xe1cil",tarifa:"2.0TD",periodos:{P1:.2215,P2:.1435,P3:.1155}},{modalidad:"Fijo Estable",tarifa:"2.0TD",periodos:{P1:.1545,P2:.1545,P3:.1545}},{modalidad:"Fijo F\xe1cil",tarifa:"3.0TD",periodos:{P1:.1795,P2:.1595,P3:.1395,P4:.1295,P5:.1055,P6:.1095}},{modalidad:"Fijo Estable",tarifa:"3.0TD",periodos:{P1:.1295,P2:.1295,P3:.1295,P4:.1295,P5:.1295,P6:.1295}},{modalidad:"Fijo F\xe1cil",tarifa:"6.1TD",periodos:{P1:.1595,P2:.1295,P3:.1195,P4:.1095,P5:.0975,P6:.0995}},{modalidad:"Fijo Estable",tarifa:"6.1TD",periodos:{P1:.1145,P2:.1145,P3:.1145,P4:.1145,P5:.1145,P6:.1145}},{modalidad:"Passpool",tarifa:"2.0TD",periodos:{P1:.132786592,P2:.07295032,P3:.042579}},{modalidad:"Passpool",tarifa:"3.0TD",periodos:{P1:.101640338,P2:.079924486,P3:.053667118,P4:.053596152,P5:.047481152,P6:.0408762}},{modalidad:"Passpool",tarifa:"6.1TD",periodos:{P1:.079516578,P2:.065463185,P3:.04287227,P4:.0449841106,P5:.0394538106,P6:.03586368}},{modalidad:"Fijo Dyn",tarifa:"3.0TD",periodos:{P1:.1475,P2:.1475,P3:.1475,P4:.1475,P5:.1475,P6:.1095}},{modalidad:"Fijo Dyn",tarifa:"6.1TD",periodos:{P1:.1255,P2:.1255,P3:.1255,P4:.1255,P5:.1255,P6:.0995}},{modalidad:"Fijo Snap Mini",tarifa:"2.0TD",periodos:{P1:.1095,P2:.1095,P3:.1095}},{modalidad:"Fijo Snap Max",tarifa:"2.0TD",periodos:{P1:.1395,P2:.1395,P3:.1395}},{modalidad:"Fijo Snap Fresh",tarifa:"2.0TD",periodos:{P1:.1295,P2:.1295,P3:.1295}},{modalidad:"Fijo Snap",tarifa:"2.0TD",periodos:{P1:.1295,P2:.1295,P3:.1295}}],F={datos:[{periodo:"JULIO 24-JUNIO 25",periodos:{P1:1.11272531611515,P2:1.04654291094969,P3:.930992736077482}}]},C=[{tarifa:"3.0TD",datos:[{periodo:"JULIO 24-JUNIO 25",periodos:{P1:1.47524885660479,P2:1.32754909873554,P3:1.12294861447404,P4:.775087436104385,P5:.520715630885122,P6:.930992736077482}}]},{tarifa:"6.1TD",datos:[{periodo:"JULIO 24-JUNIO 25",periodos:{P1:1.47524885660479,P2:1.32754909873554,P3:1.12294861447404,P4:.775087436104385,P5:.520715630885122,P6:.930992736077482}}]}],k=[{tarifa:"2.0TD",periodos:{P1:.073782329,P2:.0019112,P3:void 0,P4:void 0,P5:void 0,P6:void 0}},{tarifa:"3.0TD",periodos:{P1:.05385889,P2:.028086715,P3:.011678181,P4:.010086441,P5:.00637854,P6:.003716148}},{tarifa:"6.1TD",periodos:{P1:.078881825,P2:.041308611,P3:.017970329,P4:.014170096,P5:.005295356,P6:.00250983}}],D=e=>Math.round(1e6*e)/1e6,E=(0,N.v)((e,r)=>({tarifa:null,producto:"",resultados:null,resultadosPotencia:null,factura:null,setTarifa:r=>{e({tarifa:r})},setProducto:(r,a,t,o)=>{if(!r)return null;let l=["P1","P2","P3","P4","P5","P6"].map(e=>{let{base:l,oferta:n}=((e,r,a,t,o)=>{let l=((e,r,a)=>{var t;let o=w.find(a=>a.tarifa===e&&a.modalidad===r);return null!=(t=null==o?void 0:o.periodos[a])?t:0})(e,"Index Coste"===r||"Index Promo"===r?"Index Base":r,a),n=((e,r)=>{var a,t;if("2.0TD"===e)return null!=(a=F.datos[0].periodos[r])?a:0;let o=C.find(r=>r.tarifa===e);return null!=(t=null==o?void 0:o.datos[0].periodos[r])?t:0})(e,a),i=0,s=(i=r.startsWith("Fijo")?l:"Index Coste"===r||"Passpool"===r?l+t*n*1.15/1e3:"Index Base"===r?l+(t+5)*n*1.15/1e3:"Index Promo"===r?l+(t+8)*n*1.15/1e3:l+(t+5)*n*1.15/1e3)+o/1e3;return{base:D(i),oferta:D(s)}})(r,a,e,t,o);return{periodo:e,base:l,oferta:n}}),n={producto:a,periodos:l};return e({producto:a,resultados:n}),n},setPotencia:(r,a,t)=>{if(!r)return null;let o=["P1","P2","P3","P4","P5","P6"].map(e=>{let{base:o,oferta:l}=((e,r,a,t)=>{let o=((e,r)=>{var a;let t=k.find(r=>r.tarifa===e);return null!=(a=null==t?void 0:t.periodos[r])?a:0})(e,r),l="Index Promo"===t?o:o+a/365;return{base:D(o),oferta:D(l)}})(r,e,a,t);return{periodo:e,basePotencia:o,ofertaPotencia:l}}),l={tarifa:r,periodos:o};return e({resultadosPotencia:l}),l},calcularFactura:a=>{let{resultados:t,resultadosPotencia:o}=r();if(!t||!o)return null;let l=((e,r,a)=>{let t=["P1","P2","P3","P4","P5","P6"].map((t,o)=>{var l,n,i,s,d,c,u,p;let m=null!=(d=null==(l=a.energia[o])?void 0:l.kwh)?d:0,f=null!=(c=null==(n=a.potencia[o])?void 0:n.kw)?c:0;if(0===m&&0===f)return null;let x=null!=(u=null==(i=e.periodos[o])?void 0:i.oferta)?u:0,v=null!=(p=null==(s=r.periodos[o])?void 0:s.ofertaPotencia)?p:0,h=m>0?D(m*x):0,P=f>0?D(f*v*31):0,g=D(h+P);return{periodo:t,kwh:m,kw:f,precioEnergiaOferta:x,precioPotenciaOferta:v,costeEnergia:h,costePotencia:P,totalPeriodo:g}}).filter(Boolean),o=D(t.reduce((e,r)=>e+r.kwh,0)),l=D(t.reduce((e,r)=>e+r.costeEnergia,0)),n=D(t.reduce((e,r)=>e+r.costePotencia,0)),i=D((l+n+.2)*.0511269632),s=l+n+.2+i+a.detalle.equipos,d=.21*s,c=D(s+d),u=Math.round(1e3*(a.detalle.total-c))/1e3,p=parseFloat((u/a.detalle.total*100).toFixed(2)),m=10*o,f=Number((((a.detalle.totales_energia.activa_eur-l)/o*m+(a.detalle.totales_potencia.potencia_eur-n)/31*365+a.detalle.otros/31*365)*1.2611269632).toFixed(2));return{periodos:t,totalEnergia:l,totalPotencia:n,total:c,ahorroEstudio:u,ahorro_porcent:p,ahorroXAnio:f,subTotal:s,impuestoElectrico:i,iva:d,totalAnio:m}})(t,o,a);return e({factura:l}),l}}));var T=a(3281);let I=async(e,r)=>{try{let a=await T.a.post("/historialComparador/pdf",r,{responseType:"blob",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),t=new Blob([a.data],{type:"application/pdf"}),o=window.URL.createObjectURL(t),l=document.createElement("a");return l.href=o,l.download="Comparacion_".concat(r.archivoId,".pdf"),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(o),!0}catch(e){throw console.error("Error al generar/descargar PDF:",e),e}};var A=function(e){return e.KW="kW",e.KWh="kWh",e}({});let S=e=>{let{open:r,onClose:a,matilData:l,fileId:i,token:s}=e,d=(null==l?void 0:l.tarifa)?P[null==l?void 0:l.tarifa][0]:"Index Base",{register:c,formState:{errors:u},watch:p}=(0,h.mN)({defaultValues:{producto:d}}),[N,w]=(0,o.useState)([0]),[F,C]=(0,o.useState)([0]),[k,D]=(0,o.useState)(),T=p("producto"),S=g(T),_=Number(p("precioMedio"))||20,{comision:O,calcular:z}=y(),R=E();(0,o.useEffect)(()=>{z({matilData:l,feeEnergia:N,comisionEnergia:S,feePotencia:F,productoSeleccionado:T,getIndexBase:g})},[l,N,F,T,S,z]),(0,o.useEffect)(()=>{if(!l)return;let e=null==l?void 0:l.tarifa;R.setTarifa(e),R.setProducto(e,T,_,N[0]),R.setPotencia(e,F[0],T);let r=R.calcularFactura({energia:null==l?void 0:l.energia,potencia:null==l?void 0:l.potencia,detalle:null==l?void 0:l.detalle});D(null!=r?r:void 0)},[l,T,_,N,F]);let B=async()=>{try{var e,r,a,t,o,n,d,c,u,p,m,f,x,v;let h=(null==k?void 0:k.periodos)||[],{nombreEmpresa:P,razonSocial:g}=(e=>{if(!e)return{nombreEmpresa:"-",razonSocial:"-"};let r=e.match(/(.*?)(\b(SA|S\.?A\.?|SL|S\.?L\.?|SAC|S\.?A\.?C\.?|SRL|S\.?R\.?L\.?)\b.*)$/i);return{nombreEmpresa:r?r[1].trim():e.trim(),razonSocial:r?r[2].replace(/\./g,"").toUpperCase():"-"}})(null==l?void 0:l.titular),b={lineas:[...((null==l?void 0:l.energia)||[]).map(e=>{let r=h.find(r=>r.periodo==="P".concat(e.p));return{termino:"ENERG\xcdA P".concat(e.p),unidad:A.KWh,valor:e.kwh,precioActual:e.kwh?e.activa_eur/e.kwh:0,costeActual:e.activa_eur,precioOferta:r?r.precioEnergiaOferta:0,costeOferta:r?r.costeEnergia:0}}),...((null==l?void 0:l.potencia)||[]).map(e=>{let r=h.find(r=>r.periodo==="P".concat(e.p));return{termino:"POTENCIA P".concat(e.p),unidad:A.KW,valor:e.kw,precioActual:e.kw?e.potencia_eur/e.kw/31:0,costeActual:e.potencia_eur,precioOferta:r?r.precioPotenciaOferta:0,costeOferta:r?r.costePotencia:0}})],archivoId:i,usuario:"usuario_ejemplo",cups:(null==l?void 0:l.cups)||"-",datos:{titulo:"Comparativa de oferta",tarifa:(null==l?void 0:l.tarifa)||"-",modalidad:T,periodo:(null==l?void 0:l.fecha_fin)||"-",diasFactura:31,ahorro:(null==k?void 0:k.ahorroEstudio)||0,ahorroPorcentaje:(null==k?void 0:k.ahorro_porcent)||0,ahorroAnual:(null==k?void 0:k.ahorroXAnio)||0,consumoAnual:(null==k?void 0:k.totalAnio)||0},cliente:{cif:(null==l?void 0:l.nif)||"-",nombreCliente:P,razonSocial:g||"-",direccion:"".concat(null==l||null==(r=l.direccion)||null==(e=r.tipo_via)?void 0:e.slice(0,2).toUpperCase()," ").concat(null==l||null==(a=l.direccion)?void 0:a.nombre_via,", ").concat(null==l||null==(t=l.direccion)?void 0:t.numero," ").concat(null==l||null==(o=l.direccion)?void 0:o.detalles)||"-"},totales:{baseActual:(null==l||null==(n=l.detalle)?void 0:n.subtotal)||0,baseOferta:(null==k?void 0:k.subTotal)||0,impuestoElectricoActual:(null==l||null==(d=l.detalle)?void 0:d.ie)||0,impuestoElectricoOferta:(null==k?void 0:k.impuestoElectrico)||0,alquilerEquipo:(null==l||null==(c=l.detalle)?void 0:c.equipos)||0,ivaActual:(null==l||null==(p=l.detalle)||null==(u=p.iva_igic)?void 0:u.valor)||0,ivaOferta:(null==k?void 0:k.iva)||0,totalActual:(null==l||null==(m=l.detalle)?void 0:m.total)||0,totalOferta:(null==k?void 0:k.total)||0,otrosComunesConIeActual:(null==l||null==(f=l.detalle)?void 0:f.bono_social)||0,otrosComunesConIeOferta:(null==l||null==(x=l.detalle)?void 0:x.bono_social)||0,otrosComunesSinIeActual:0,otrosComunesSinIeOferta:0,otrosNoComunesActual:(null==l||null==(v=l.detalle)?void 0:v.otros)||0,otrosNoComunesOferta:0}};await I(s,b)}catch(e){console.error("Error al descargar el PDF:",e)}};return(0,t.jsx)(x.l,{open:r,onClose:a,children:(0,t.jsxs)("div",{className:"space-y-6 p-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:"Configura el producto"})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(b.l,{label:"Producto a ofertar",name:"producto",options:(null==l?void 0:l.tarifa)?P[null==l?void 0:l.tarifa].map(e=>({label:e,value:e})):[],placeholder:"Elige una opci\xf3n",register:c,required:!0,errors:u}),(0,t.jsx)(j.p,{label:"Precio medio OMIE (€/MWh)",type:"number",name:"precioMedio",placeholder:"20",register:c,required:!0,errors:u})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"flex pb-2 items-center",children:(0,t.jsx)("label",{htmlFor:"feeEnergia",className:"text-sm font-medium text-foreground",children:"Fee energ\xeda"})}),(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("div",{className:"absolute -top-4 text-xs font-semibold transition-colors \n    ".concat(0===N[0]?"text-red-500":50===N[0]?"text-green-600":"text-foreground"),style:{left:"".concat(N[0],"%"),transform:"translateX(-50%)"},children:N[0]}),(0,t.jsx)(v,{value:N,onValueChange:w,max:50,min:0,step:1}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("span",{className:"text-sm font-semibold transition-colors ".concat(50===N[0]?"text-green-600":"text-foreground"),children:"50"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"flex pb-2 items-center",children:(0,t.jsx)("label",{htmlFor:"feePotencia",className:"text-sm font-medium text-foreground",children:"Fee potencia"})}),(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("div",{className:"absolute -top-4 text-xs font-semibold transition-colors \n    ".concat(0===F[0]?"text-red-500":25===F[0]?"text-green-600":"text-foreground"),style:{left:"".concat(F[0],"%"),transform:"translateX(-50%)"},children:F[0]}),(0,t.jsx)(v,{value:F,onValueChange:C,max:25,min:0,step:1})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("span",{className:"text-sm font-semibold transition-colors ".concat(25===F[0]?"text-green-600":"text-foreground"),children:"25"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 rounded-lg bg-input",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground mb-1",children:"Comisi\xf3n comercial"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-foreground",children:Math.trunc(Number(O))+"€"}),(0,t.jsx)("p",{className:"text-sm text-green-500",children:"+ 10% extra"})]}),(0,t.jsxs)("div",{className:"p-4 rounded-lg bg-input",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground mb-1",children:"Ahorro cliente"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-foreground",children:[Math.trunc(Number(null==k?void 0:k.ahorroEstudio)),"€ al mes"]}),(0,t.jsxs)("p",{className:"text-xl font-bold text-foreground ".concat((null==k?void 0:k.ahorroXAnio)&&k.ahorroXAnio>0?"text-green-500":"text-red-500"),children:[Math.trunc(Number(null==k?void 0:k.ahorroXAnio)),"€ al a\xf1o"]}),(0,t.jsxs)("p",{className:"text-sm text-green-500",children:["+ ",null==k?void 0:k.ahorro_porcent,"% de ahorro"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-4 pt-2 border-t border-gray-200",children:[(0,t.jsxs)(n.$,{variant:"outline",onClick:()=>{},className:"flex-1",children:[(0,t.jsx)(m,{className:"w-4 h-4 mr-2"}),"Enviar al cliente"]}),(0,t.jsxs)(n.$,{onClick:B,className:"flex-1",children:[(0,t.jsx)(f,{className:"w-4 h-4 mr-2"}),"Descargar en PDF"]})]})]})})};var _=a(7925),O=a(8519);let z=async(e,r,a,t)=>{try{let o=new FormData;return o.append("Archivo",r),o.append("Nombre",a),o.append("Tipo",t.toString()),(await T.a.post("/archivos/upload-and-process",o,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(e)}})).data}catch(e){throw console.error("Error al subir y procesar documento:",e),e}};var R=a(5493);let B=()=>{let[e,r]=(0,o.useState)(null),[a,i]=(0,o.useState)(null),[s,d]=(0,o.useState)(null),[c,u]=(0,o.useState)(!1),{setLoading:m}=(0,_.r)(),{showAlert:f}=(0,O.B)(),{data:x}=(0,R.wV)(),v=async()=>{if(s&&"string"!=typeof s){m(!0);try{var e,a,t;let o=(e=>{var r;switch(null==(r=e.name.split(".").pop())?void 0:r.toLowerCase()){case"pdf":return 1;case"jpg":return 2;case"png":return 3;case"jpeg":return 4;default:throw Error("Tipo de archivo no soportado")}})(s),l=s.name.split(".")[0],n=null==x||null==(e=x.user)?void 0:e.token;if(!n){f("No se encontr\xf3 el token de autenticaci\xf3n.","error"),m(!1);return}let d=await z(n,s,l,o);r(null==d||null==(a=d.result)?void 0:a.ocrData),i(null==d||null==(t=d.result)?void 0:t.id),u(!0),f("Documento procesado correctamente.","success")}catch(e){console.error("Error al analizar documento:",e),f("Error al procesar el documento.","error")}finally{m(!1)}}};return(0,t.jsxs)("div",{className:"min-h-screen px-6 py-8 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-2xl text-foreground font-bold",children:"Comparador de Precios"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Sube tu factura para realizar comparaciones y ajustes."})]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsxs)(l.Zp,{className:"w-full max-w-2xl rounded-xl p-6 space-y-4",children:[(0,t.jsx)(p,{onFileSelect:e=>{d(e)}}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(n.$,{size:"sm",onClick:v,disabled:!s,children:"Comparar"})})]})}),(0,t.jsx)(S,{open:c,onClose:()=>u(!1),matilData:e,fileId:a||"",token:(null==x?void 0:x.user.token)||""})]})}},7470:(e,r,a)=>{"use strict";a.d(r,{l:()=>o});var t=a(5155);a(2115);let o=e=>{let{label:r,name:a,options:o,placeholder:l,register:n,required:i=!1,errors:s}=e;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("label",{htmlFor:a,className:"block text-sm font-medium text-foreground",children:[r," ",i&&(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{id:a,...n(a,{required:i}),className:"w-full bg-input rounded border px-3 py-1 focus:outline-none focus:ring ".concat(s&&s[a]?"border-red-500 ring-red-500":"border-border ring-blue-500"),children:[l&&(0,t.jsx)("option",{value:"",disabled:!0,selected:!0,hidden:!0,children:l}),o.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),s&&s[a]&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Este campo es obligatorio"})]})}},7703:(e,r,a)=>{"use strict";a.d(r,{Wu:()=>d,ZB:()=>s,Zp:()=>n,aR:()=>i});var t=a(5155),o=a(1932),l=a(2115);let n=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("rounded-lg bg-card text-card-foreground shadow-sm",a),...l})});n.displayName="Card";let i=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...l})});i.displayName="CardHeader";let s=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,t.jsx)("h3",{ref:r,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...l})});s.displayName="CardTitle",l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,t.jsx)("p",{ref:r,className:(0,o.cn)("text-sm text-muted-foreground",a),...l})}).displayName="CardDescription";let d=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("p-6 pt-0",a),...l})});d.displayName="CardContent",l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("flex items-center p-6 pt-0",a),...l})}).displayName="CardFooter"},7925:(e,r,a)=>{"use strict";a.d(r,{r:()=>t});let t=(0,a(5453).v)(e=>({loading:!1,setLoading:r=>e({loading:r})}))},8519:(e,r,a)=>{"use strict";a.d(r,{B:()=>t});let t=(0,a(5453).v)(e=>({alert:{message:"",type:"info",visible:!1},showAlert:(r,a)=>e({alert:{message:r,type:a,visible:!0}}),hideAlert:()=>e({alert:{message:"",type:"info",visible:!1}})}))}},e=>{e.O(0,[497,281,641,464,488,441,964,358],()=>e(e.s=6784)),_N_E=e.O()}]);